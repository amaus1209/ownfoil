{% extends "base.html" %}

{% block content %}
{% include 'nav.html' %}
<div id="content" class="container-fluid mt-3">

    <div class="row gy-2 gx-3 align-items-center justify-content-md-center">
        <div class="col-auto">
            <div class="btn-group dropdown-center" role="group">
                <div class="btn-group" role="group">
                    <button id="filterDropdownBtn" type="button" class="btn btn-primary dropdown-toggle"
                        data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                        <i class="bi bi-funnel-fill"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckBase">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckBase">
                                BASE
                            </label>
                        </li>
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckDlc">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckDlc">
                                DLC
                            </label>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckUpToDate">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckUpToDate">
                                Up to date
                            </label>
                        </li>
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckMissingUpdate">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckMissingUpdate">
                                Missing Update
                            </label>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckComplete">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckComplete">
                                Complete
                            </label>
                        </li>
                        <li>
                            <label class="form-check-label dropdown-item" for="filterCheckMissingDlc">
                                <input class="form-check-input filterLabel" type="checkbox" value="" id="filterCheckMissingDlc">
                                Missing DLC
                            </label>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-auto">
            <input type="text" id="textFilter" class="form-control" placeholder="Search titles...">
        </div>
        <div class="col-auto">
            <div class="btn-group" role="group">
                <button id="view-toggle-btn-card" type="button" class="btn btn-primary view-toggle-btn active"
                    data-view="card"><i class="bi bi-card-heading"></i></button>
                <button id="view-toggle-btn-icon" type="button" class="btn btn-primary view-toggle-btn"
                    data-view="icon"><i class="bi bi-grid-fill"></i></button>
                <button id="view-toggle-btn-list" type="button" class="btn btn-primary view-toggle-btn"
                    data-view="list"><i class="bi bi-list-ul"></i></button>
            </div>
        </div>
        <div class="col-auto">
            <div class="btn-group dropdown-center" role="group">
                <button id="itemsPerPageDropdownBtn" type="button" class="btn btn-primary dropdown-toggle"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Items per page
                </button>
                <ul class="dropdown-menu" aria-labelledby="itemsPerPageDropdownBtn">
                    <li><button class="dropdown-item items-per-page" data-value="9">9</button></li>
                    <li><button class="dropdown-item items-per-page" data-value="12">12</button></li>
                    <li><button class="dropdown-item items-per-page" data-value="18">18</button></li>
                    <li><button class="dropdown-item items-per-page" data-value="27">27</button></li>
                </ul>
            </div>
        </div>
        <div class="col-auto">
            <input type="range" class="form-range" min="1" max="5" step="1" id="cardSizeRange">
        </div>
    </div>

    <div class="grid-container" id="gridContainer">
        <div class="row g-4" id="gameGrid"></div>
    </div>

    <nav aria-label="Page navigation" class="mt-3">
        <ul class="pagination justify-content-center" id="paginationControls"></ul>
    </nav>
</div>

<script>
    let games;
    let filteredGames;
    let itemsPerPage = 12;
    let currentPage = 1;
    let currentView = 'card'; // Default view

    function fetchGames() {
        // Fetch games from API
        return new Promise((resolve, reject) => {
            $.get(`/api/titles`, function (data) {
                games = data.games;
                filteredGames = games;
                resolve();
            }).fail(function () {
                reject();
            });
        });
    }

    function renderGames() {
        if (currentView === 'card') {
            renderCardView();
        } else if (currentView === 'icon') {
            renderIconView();
        } else if (currentView === 'list') {
            renderListView();
        }
    }

    function renderListView() {
        const gameGrid = $('#gameGrid');
        gameGrid.empty();

        const listContainer = $('<ul class="list-group"></ul>');
        filteredGames.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage).forEach(game => {
            const listItem = $('<li class="list-group-item d-flex justify-content-between align-items-center"></li>');
            listItem.append(`<strong>${game.name}</strong>`);
            listItem.append(`<span>${game.type}</span>`);
            listContainer.append(listItem);
        });

        gameGrid.append(listContainer);
        updatePaginationControls();
    }

    function updatePaginationControls() {
        // Logic to update pagination
    }

    $(document).ready(function () {
        fetchGames().then(() => renderGames());

        $('.view-toggle-btn').on('click', function () {
            $('.view-toggle-btn').removeClass('active');
            $(this).addClass('active');
            currentView = $(this).data('view');
            renderGames();
        });
    });
</script>
{% endblock %}
